<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>受訪者回覆表單</title>
  <style>
    body { font-family: Arial; background: #f9f9f9; padding: 20px; }
    .form-container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    button { margin-top: 20px; background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #45a049; }
    #preview { white-space: pre-wrap; background: #eee; padding: 10px; margin-top: 10px; border-radius: 4px; font-family: monospace; }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>受訪者回覆</h2>
    <label>單位名稱：</label><input type="text" id="org">
    <label>職稱：</label><input type="text" id="title">
    <label>名字：</label><input type="text" id="name">
    <div id="questions"></div>

    <button onclick="previewResponse()">預覽回覆內容</button>
    <div id="preview"></div>
    <button onclick="goBack()">清除預覽</button>
    <button onclick="submitResponse()">產生回覆連結</button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const reporterUid = urlParams.get("uid") || "unknown";
    const interviewId = urlParams.get("interview") || "interview_20251010_001";

    const interview = {
      id: interviewId,
      title: "AI 對生活的影響",
      questions: [
        { id: 1, text: "你認為 AI 會取代哪些工作？" },
        { id: 2, text: "AI 是否會影響人類的創造力？" }
      ]
    };

    const container = document.getElementById("questions");
    container.innerHTML += `<label>採訪標題：</label><div style="margin-top:5px;">${interview.title}</div>`;
    interview.questions.forEach(q => {
      container.innerHTML += `<label>${q.text}</label><textarea id="q${q.id}"></textarea>`;
    });

    function buildResponseObject() {
      const org = document.getElementById("org").value;
      const title = document.getElementById("title").value;
      const name = document.getElementById("name").value;
      const answers = interview.questions.map(q => ({
        questionId: q.id,
        answer: document.getElementById(`q${q.id}`).value
      }));
      return {
        reporterUid: reporterUid,
        interviewId: interview.id,
        organization: org,
        title: title,
        name: name,
        answers: answers,
        submittedAt: new Date().toISOString()
      };
    }

    function previewResponse() {
      const response = buildResponseObject();
      let text = `採訪標題：${interview.title}\n\n`;
      text += `受訪者：${response.name}\n單位：${response.organization}\n職稱：${response.title}\n\n`;
      response.answers.forEach((a, i) => {
        text += `Q${i + 1}: ${interview.questions[i].text}\nA${i + 1}: ${a.answer}\n\n`;
      });
      text += `記者 UID：${reporterUid}\n採訪 ID：${interview.id}\n提交時間：${response.submittedAt}`;
      document.getElementById("preview").innerText = text;
    }

    function goBack() {
      document.getElementById("preview").innerText = "";
    }

    function submitResponse() {
      const response = buildResponseObject();
      fetch("https://your-server.com/api/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(response)
      }).then(res => {
        if (res.ok) {
          alert("已送出回覆！");
        } else {
          res.text().then(msg => {
            alert("送出失敗：" + msg);
          });
        }
      }).catch(err => {
        alert("送出失敗：" + err.message);
      });
    }
  </script>
</body>
</html>
