<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>受訪者回覆表單</title>
  <style>/* 保留原 CSS */</style>
</head>
<body>
  <div class="form-container">
    <h2>受訪者回覆</h2>
    <label>單位名稱：</label>
    <input type="text" id="org">
    <label>職稱：</label>
    <input type="text" id="title">
    <label>名字：</label>
    <input type="text" id="name">
    <div id="questions"></div>
    <button onclick="previewResponse()">確認</button>
    <div id="preview" style="white-space:pre-wrap; background:#eee; padding:10px; margin-top:10px;"></div>
    <button onclick="submitResponse()">送出</button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const reporterUid = urlParams.get("uid") || "unknown";
    const interview = {
      id: "interview_20251010_001",
      title: "AI 對生活的影響",
      questions: [
        { id: 1, text: "你認為 AI 會取代哪些工作？" },
        { id: 2, text: "AI 是否會影響人類的創造力？" }
      ]
    };

    const container = document.getElementById("questions");
    interview.questions.forEach(q => {
      container.innerHTML += `<label>${q.text}</label><textarea id="q${q.id}"></textarea>`;
    });

    function buildResponseObject() {
      const org = document.getElementById("org").value;
      const title = document.getElementById("title").value;
      const name = document.getElementById("name").value;
      const answers = interview.questions.map(q => ({
        questionId: q.id,
        answer: document.getElementById(`q${q.id}`).value
      }));
      return {
        reporterUid: reporterUid,
        interviewId: interview.id,
        organization: org,
        title: title,
        name: name,
        answers: answers,
        submittedAt: new Date().toISOString()
      };
    }

    function previewResponse() {
      const response = buildResponseObject();
      document.getElementById("preview").innerText = JSON.stringify(response, null, 2);
    }

    function submitResponse() {
      const response = buildResponseObject();
      fetch("https://your-server.com/api/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(response)
      }).then(res => {
        if (res.ok) {
          alert("已送出回覆！");
        } else {
          alert("送出失敗！");
        }
      });
    }
  </script>
</body>
</html>
