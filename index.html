<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>受訪者回覆表單</title>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    .form { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
    button { margin-top: 20px; padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #45a049; }
    #preview { white-space: pre-wrap; background: #eee; padding: 10px; margin-top: 10px; border-radius: 4px; font-family: monospace; }
  </style>
</head>
<body>
  <div class="form">
    <h2>受訪者回覆</h2>
    <label>單位：</label><input id="org">
    <label>職稱：</label><input id="title">
    <label>名字：</label><input id="name">
    <div id="questions"></div>
    <button onclick="preview()">預覽回覆</button>
    <div id="preview"></div>
    <button onclick="submit()">產生回覆連結</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAS1k8LoWuUfD48yW7BaNjr_7HEvj7sVSc",
      authDomain: "reporterapp-1cf28.firebaseapp.com",
      databaseURL: "https://reporterapp-1cf28-default-rtdb.firebaseio.com",
      projectId: "reporterapp-1cf28",
      storageBucket: "reporterapp-1cf28.appspot.com",
      messagingSenderId: "226849515931",
      appId: "1:226849515931:web:fc96606681592dc56c193e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const urlParams = new URLSearchParams(location.search);
    const reporterUid = urlParams.get("uid") || "unknown";
    const interviewId = urlParams.get("interview") || "interview_20251010_001";

    const interview = {
      title: "AI 對生活的影響",
      questions: [
        { id: 1, text: "你認為 AI 會取代哪些工作？" },
        { id: 2, text: "AI 是否會影響人類的創造力？" }
      ]
    };

    const container = document.getElementById("questions");
    container.innerHTML += `<label>採訪標題：</label><div>${interview.title}</div>`;
    interview.questions.forEach(q => {
      container.innerHTML += `<label>${q.text}</label><textarea id="q${q.id}"></textarea>`;
    });

    function buildResponse() {
      return {
        reporterUid,
        interviewId,
        name: document.getElementById("name").value,
        organization: document.getElementById("org").value,
        title: document.getElementById("title").value,
        submittedAt: new Date().toISOString(),
        answers: interview.questions.map(q => ({
          questionId: q.id,
          answer: document.getElementById(`q${q.id}`).value
        }))
      };
    }

    function preview() {
      const r = buildResponse();
      let text = `採訪標題：${interview.title}\n\n`;
      text += `受訪者：${r.name}\n單位：${r.organization}\n職稱：${r.title}\n\n`;
      r.answers.forEach((a, i) => {
        text += `Q${i + 1}: ${interview.questions[i].text}\nA${i + 1}: ${a.answer}\n\n`;
      });
      text += `記者 UID：${reporterUid}\n採訪 ID：${interviewId}\n提交時間：${r.submittedAt}`;
      document.getElementById("preview").innerText = text;
    }

    function submit() {
      const r = buildResponse();
      const ref = db.ref(`responses/${reporterUid}/${interviewId}`);
      ref.push().set(r).then(() => {
        alert("回覆已送出！");
      }).catch(err => {
        alert("送出失敗：" + err.message);
      });
    }
  </script>
</body>
</html>
